require 'toto'

@config = Toto::Config::Defaults
# @config = Toto::Config

task :default => :new

desc "New..."
task :new do
  title = ask('Title: ')
  tags = ask('Tags: ')
  slug = title.empty?? nil : title.strip.slugize

  # article = {'title' => title, 'date' => Time.now.strftime("%d/%m/%Y"), 'tags' => tags, 'author' => @config[:author]}.to_yaml
  article = {'title' => title, 'date' => Time.now.strftime("%d/%m/%Y"), 'tags' => tags, 'author' => 'Panos G. Pgn'}.to_yaml
  article << "\n"
  article << "&nbsp;\n"

  path = "#{Toto::Paths[:articles]}/#{Time.now.strftime("%Y-%m-%d")}#{'-' + slug if slug}.#{@config[:ext]}"

  unless File.exist? path
    File.open(path, "w") do |file|
      file.write article
    end
    toto "an article was created for you at #{path}"
  else
    toto "i can't create the article, #{path} already exists"
  end
end

desc "Publish..."
task :publish do
  toto "publishing your article(s)..."
  # `git push heroku master`
  `git push origin master`
  #`git push remote master`
end

def toto msg
  puts "\n  toto ~ #{msg}\n\n"
end

def ask message
  print message
  STDIN.gets.chomp
end
